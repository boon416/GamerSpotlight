<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ä¸Šä¼ å•†å“</title>
  <style>
    body {
      background-color: white;
      color: black;
      padding: 2rem;
      font-family: sans-serif;
    }
    input, textarea {
      display: block;
      margin-bottom: 1rem;
      width: 100%;
      max-width: 400px;
    }
  </style>
</head>
<body>
  <h2>ğŸ›’ ä¸Šä¼ å•†å“</h2>

  <form id="uploadForm">
    <input type="text" name="name" placeholder="å•†å“åç§°" required>
    <textarea name="description" placeholder="å•†å“æè¿°" rows="3" required></textarea>
    <input type="number" name="price" placeholder="èµ·æ ‡ä»· (RM)" required>
    <input type="text" name="tags" placeholder="è¾“å…¥æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰">
    <input type="file" name="images" id="images" multiple accept="image/*">
    <label><input type="checkbox" name="isBiddable"> å¯ç«æ ‡</label>
    <br>
    <button type="submit">ğŸ“¤ ä¸Šä¼ å•†å“</button>
  </form>

  <script>
    const endpoint = "https://c5c4dn0f95.execute-api.ap-southeast-1.amazonaws.com/dev/uploadProduct";

    document.getElementById("uploadForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const token = sessionStorage.getItem("idToken");
      if (!token) {
        alert("âš ï¸ è¯·å…ˆç™»å½•");
        return;
      }

      const form = e.target;
      const formData = new FormData();

      formData.append("name", form.name.value);
      formData.append("description", form.description.value);
      formData.append("price", form.price.value);
      formData.append("tags", form.tags.value);
      formData.append("isBiddable", form.isBiddable.checked.toString());

      const images = document.getElementById("images").files;
      for (let i = 0; i < images.length; i++) {
        formData.append(`file${i}`, images[i]); // â¬…ï¸ æ¯å¼ å›¾éƒ½ç”¨ä¸åŒ key
      }

      try {
        const res = await fetch(endpoint, {
          method: "POST",
          headers: {
            Authorization: `Bearer ${token}`
          },
          body: formData
        });

        const result = await res.json();
        if (res.ok) {
          window.location.href = "store.html?success=1";
        } else {
          alert("âŒ ä¸Šä¼ å¤±è´¥ï¼š" + (result.detail || result.message));
        }
      } catch (err) {
        alert("âŒ ä¸Šä¼ å¤±è´¥ï¼š" + err.message);
        console.error("ä¸Šä¼ å¤±è´¥:", err);
      }
    });
  </script>
</body>
</html>
